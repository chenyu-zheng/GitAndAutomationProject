"use strict";var _get=function t(e,i,o){null===e&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,i);if(void 0===s){var n=Object.getPrototypeOf(e);return null===n?void 0:t(n,i,o)}if("value"in s)return s.value;var r=s.get;return void 0!==r?r.call(o):void 0},_createClass=function(){function o(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}();function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Sprite=function(){function p(t){var e=t.texture,i=t.x,o=t.y,s=t.width,n=t.height,r=t.offsetX,h=void 0===r?0:r,a=t.offsetY,c=void 0===a?0:a,l=t.collisionWidth,f=void 0===l?0:l,u=t.collisionHeight,d=void 0===u?0:u;_classCallCheck(this,p),this.texture=e,this.x=i,this.y=o,this.width=s,this.height=n,this.offsetX=h,this.offsetY=c,this.frame={sx:0,xy:0,sWidth:this.width,sHeight:this.height},this.vx=0,this.vy=0,this.collisionWidth=f,this.collisionHeight=d}return _createClass(p,[{key:"render",value:function(){ctx.drawImage(Resources.get(this.texture),this.frame.sx,this.frame.sy,this.frame.sWidth,this.frame.sHeight,this.x+this.offsetX,this.y+this.offsetY,this.width,this.height)}},{key:"update",value:function(t){this.x+=this.vx,this.y+=this.vy}}]),p}(),Unit=function(t){function y(t){var e=t.texture,i=t.x,o=t.y,s=t.width,n=t.height,r=t.offsetX,h=void 0===r?0:r,a=t.offsetY,c=void 0===a?0:a,l=t.collisionWidth,f=void 0===l?0:l,u=t.collisionHeight,d=void 0===u?0:u,p=t.direction,v=t.frameSet;_classCallCheck(this,y);var g=_possibleConstructorReturn(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,{texture:e,x:i,y:o,width:s,height:n,offsetX:h,offsetY:c,collisionWidth:f,collisionHeight:d}));return g.frameSet=v,g.direction=p,g.destX=g.x,g.destY=g.y,g.speed=0,g.lastMoveDistance=0,g.script,g}return _inherits(y,Sprite),_createClass(y,[{key:"isMoving",value:function(){return 0!==this.vx||0!==this.vy}},{key:"setMove",value:function(t){if(!this.isMoving())switch(this.direction=t,this.destX=this.x,this.destY=this.y,this.direction){case"left":this.destX-=101,this.vx=101*-this.speed;break;case"right":this.destX+=101,this.vx=101*this.speed;break;case"up":this.destY-=83,this.vy=83*-this.speed;break;case"down":this.destY+=83,this.vy=83*this.speed}}},{key:"update",value:function(t){this.isMoving()?Math.abs(this.x-this.destX)<Math.abs(this.vx*t)?(this.x=this.destX,this.vx=0,this.lastMoveDistance=0):Math.abs(this.y-this.destY)<Math.abs(this.vy*t)?(this.y=this.destY,this.vy=0,this.lastMoveDistance=0):(this.x+=this.vx*t,this.y+=this.vy*t,this.lastMoveDistance+=Math.abs(this.vx*t+this.vy*t)):this.script&&this.script(this),this.frame=this.frameSet[this.direction][Math.floor(this.lastMoveDistance/10)%4]}},{key:"teleport",value:function(t,e){this.x=t,this.destX=t,this.y=e,this.destY=e,this.vx=0,this.vy=0,this.lastMoveDistance=0}}]),y}(),Player=function(t){function g(t){var e=t.texture,i=t.x,o=t.y,s=t.width,n=t.height,r=t.offsetX,h=void 0===r?0:r,a=t.offsetY,c=void 0===a?0:a,l=t.collisionWidth,f=void 0===l?0:l,u=t.collisionHeight,d=void 0===u?0:u,p=t.direction,v=t.frameSet;return _classCallCheck(this,g),_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,{texture:e,x:i,y:o,width:s,height:n,offsetX:h,offsetY:c,collisionWidth:f,collisionHeight:d,direction:p,frameSet:v}))}return _inherits(g,Unit),_createClass(g,[{key:"setMove",value:function(t){this.isMoving()||("left"===t&&0<this.x||"right"===t&&this.x<606||"up"===t&&0<this.y||"down"===t&&this.y<498)&&_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"setMove",this).call(this,t)}},{key:"handleInput",value:function(t,e){"keydown"===t&&(this.script=function(t){return t.setMove(e)}),"keyup"===t&&(this.script=void 0)}}]),g}(),LevelMaker=function(t){function e(t,e){for(var i=["down","left","right","up"],o={},s=0;s<4;s++){o[i[s]]=[];for(var n=0;n<4;n++)o[i[s]][n]={sx:n*t,sy:s*e,sWidth:t,sHeight:e}}return o}var i={texture:"images/Cat Girl.png",x:303,y:498,width:64,height:96,offsetX:18,offsetY:14,collisionWidth:57,collisionHeight:47,direction:"down",frameSet:e(32,48)},s={texture:"images/Goul.png",x:0,y:0,width:80,height:110,offsetX:10,offsetY:0,collisionWidth:72,collisionHeight:59,direction:"down",frameSet:e(40,55)},n={texture:"images/Murloc.png",x:0,y:0,width:70,height:104,offsetX:10,offsetY:-1,collisionWidth:63,collisionHeight:59,direction:"down",frameSet:e(41,61)},r={texture:"images/Orc.png",x:0,y:0,width:73,height:110,offsetX:10,offsetY:-2,collisionWidth:65,collisionHeight:59,direction:"down",frameSet:e(55,77)},h={texture:"images/Werewolf.png",x:0,y:0,width:81,height:112,offsetX:10,offsetY:-7,collisionWidth:72,collisionHeight:59,direction:"down",frameSet:e(51,70)},a={texture:"images/Wolf.png",x:0,y:0,width:104,height:83,offsetX:0,offsetY:25,collisionWidth:93,collisionHeight:59,direction:"down",frameSet:e(58,46)},c={texture:"images/Spider.png",x:0,y:0,width:80,height:67,offsetX:10,offsetY:40,collisionWidth:72,collisionHeight:59,direction:"down",frameSet:e(132,112)},o=void 0,l=[];var f=function(t){t.x<=-101&&t.teleport(707,t.y),t.setMove("left")},u=function(t){707<=t.x&&t.teleport(-101,t.y),t.setMove("right")},d=[function(){var t=new Unit(n);t.teleport(404,83),t.speed=1,t.script=function(t){707<=t.x&&t.teleport(-101,t.y),t.setMove("right")},l.push(t);for(var e=0;e<3;e++)for(var i=0;i<3;i++){var o=new Unit(s);o.teleport(101*(2*i+1),83*(e+2)),o.speed=.5,o.script=1===e?f:u,l.push(o)}},function(){for(var t=0;t<4;t++){var e=new Unit(a);e.teleport(2*t*101,83*(t+1)),e.speed=2.5,e.script=u,l.push(e)}for(var i=0;i<4;i++){var o=new Unit(r);o.teleport(101*(7-2*i),83*(i+2)),o.speed=1.8,o.script=f,l.push(o)}},function(){for(var t=0;t<2;t++){var e=new Unit(h);e.teleport(2*t*101,83*(2*t+2)),e.speed=2.2,e.script=function(t){707<=t.x&&(t.teleport(-101,t.y),t.speed<10&&(t.speed+=.6)),t.setMove("right")},l.push(e)}for(var i=0;i<2;i++){var o=new Unit(h);o.teleport(101*(7-2*i),83*(2*i+3)),o.speed=2.2,o.script=function(t){t.x<=-101&&(t.teleport(707,t.y),t.speed<10&&(t.speed+=.6)),t.setMove("left")},l.push(o)}for(var s=0;s<7;s++)if(3!==s){var n=new Unit(c);n.teleport(101*s,83),n.speed=1,n.script=f,l.push(n)}}];function p(t){o&&o.handleInput(t.type,{37:"left",38:"up",39:"right",40:"down"}[t.keyCode])}t.Levels={run:function(t){return!(t>=d.length||(d[t](),(o=new Player(i)).speed=1.5,document.addEventListener("keydown",p),document.addEventListener("keyup",p),0))},clear:function(){o=void 0,l=[],document.removeEventListener("keydown",p),document.removeEventListener("keyup",p)},getPlayer:function(){return o},getEnemies:function(){return l}}};!function(){var i={},o=[];function e(t){if(i[t])return i[t];var e=new Image;e.onload=function(){i[t]=e,s()&&o.forEach(function(t){t()})},i[t]=!1,e.src=t}function s(){for(var t in i)if(i.hasOwnProperty(t)&&!i[t])return!1;return!0}window.Resources={load:function(t){t instanceof Array?t.forEach(function(t){e(t)}):e(t)},get:function(t){return i[t]},onReady:function(t){o.push(t)},isReady:s}}();var Engine=function(t){var e=t.document,o=t.window,s=e.createElement("canvas"),r=s.getContext("2d"),i=document.querySelector("div.btn-restart"),n=document.querySelector(".level span"),h=document.querySelector(".highest-level span"),a=document.querySelector(".life span"),c=void 0,l=!1,f=void 0,u={x:0,y:0},d=1,p=0,v=2,g=void 0,y=void 0,x=void 0,m=void 0,w=void 0,b=void 0;function k(){var t,e,i=Date.now();l||(t=(i-c)/1e3,g&&0<y.length&&(e=t,g.update(e),y.forEach(function(t){return t.update(e)}),y.forEach(function(t){if(Math.abs(t.x-g.x)<Math.min(t.collisionWidth,g.collisionWidth)&&Math.abs(t.y-g.y)<Math.min(t.collisionHeight,g.collisionHeight))return v--,C(3e3),_("YOU DIED",125,285,1500,"72px Nosifer","red"),void setTimeout(function(){M()},1600)}),0===g.y&&(p<d&&(p=d),d++,C(2200),_("LEVEL COMPLETE",155,285,2e3,"72px Creepster","white"),setTimeout(function(){M()},2100)))),function(){var t,e,i=["images/Stone Block.png","images/Grass Block.png","images/Grass Block.png","images/Grass Block.png","images/Grass Block.png","images/Grass Block.png","images/Stone Block.png"];for(r.clearRect(0,0,s.width,s.height),t=0;t<7;t++)for(e=0;e<7;e++)r.drawImage(Resources.get(i[t]),101*e,83*t);g&&g.render(),0<y.length&&y.forEach(function(t){return t.render()}),f&&r.fillText(f,u.x,u.y)}(),c=i,o.requestAnimationFrame(k)}function M(){(m(),g=void 0,y=[],v<0)?_("YOU LOST!",110,285,-1,"72px Nosifer","black"):(h.textContent=p,a.textContent=v,x(d-1)?(n.textContent=d,C(1500),_("LEVEL "+d,265,285,1500,"72px Creepster","red"),g=w(),y=b()):_("YOU WON!",195,292,-1,"96px Creepster","white"))}function _(t,e,i,o){var s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"72px sans-serif",n=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"red";r.fillStyle=n,r.font=s,f=t,u.x=e,u.y=i,0<=o&&setTimeout(function(){f=void 0},o)}function C(t){l=!0,setTimeout(function(){l=!1},t)}s.width=707,s.height=707,e.body.appendChild(s),Resources.load(["images/Stone Block.png","images/Grass Block.png","images/Cat Girl.png","images/Goul.png","images/Orc.png","images/Murloc.png","images/Wolf.png","images/Spider.png","images/Werewolf.png"]),Resources.onReady(function(){i.addEventListener("click",function(){l=!1,f=void 0,d=1,v=2,M()}),LevelMaker(t),x=Levels.run,m=Levels.clear,w=Levels.getPlayer,b=Levels.getEnemies,M(),c=Date.now(),k()}),t.ctx=r}(window);